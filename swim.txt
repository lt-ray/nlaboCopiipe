local player = game.Players.LocalPlayer
local userInputService = game:GetService("UserInputService")

local runSpeed = 40       -- Shiftキーで走る速度（地上）
local walkSpeed = 16      -- 通常歩行速度
local swimSpeed = 30      -- Shiftキーで泳ぐ速度
local swimWalkSpeed = 15  -- 通常の泳ぎ速度

-- プレイヤーがスポーンしたとき
player.CharacterAdded:Connect(function(character)
	local humanoid = character:WaitForChild("Humanoid")

	-- 初期歩行速度設定（泳ぎ中にキャラ追加されたとき用）
	humanoid.WalkSpeed = walkSpeed

	-- 入力開始
	userInputService.InputBegan:Connect(function(input, gameProcessed)
		if input.KeyCode == Enum.KeyCode.LeftShift and not gameProcessed then
			local state = humanoid:GetState()
			if state == Enum.HumanoidStateType.Swimming then
				humanoid.WalkSpeed = swimSpeed
			else
				humanoid.WalkSpeed = runSpeed
			end
		end
	end)

	-- 入力終了
	userInputService.InputEnded:Connect(function(input, gameProcessed)
		if input.KeyCode == Enum.KeyCode.LeftShift and not gameProcessed then
			local state = humanoid:GetState()
			if state == Enum.HumanoidStateType.Swimming then
				humanoid.WalkSpeed = swimWalkSpeed
			else
				humanoid.WalkSpeed = walkSpeed
			end
		end
	end)

	-- 状態が変わったときに対応（泳ぎ状態になったとき）
	humanoid.StateChanged:Connect(function(_, newState)
		if newState == Enum.HumanoidStateType.Swimming then
			if userInputService:IsKeyDown(Enum.KeyCode.LeftShift) then
				humanoid.WalkSpeed = swimSpeed
			else
				humanoid.WalkSpeed = swimWalkSpeed
			end
		elseif newState == Enum.HumanoidStateType.Running or newState == Enum.HumanoidStateType.Walking then
			if userInputService:IsKeyDown(Enum.KeyCode.LeftShift) then
				humanoid.WalkSpeed = runSpeed
			else
				humanoid.WalkSpeed = walkSpeed
			end
		end
	end)
end)
